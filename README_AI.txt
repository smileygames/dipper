============================================================
dipper / AI共有用 README（設計思想・開発ルール要約）
============================================================

※ このファイルは ChatGPT 等の AI を
dipper 開発に参加させるための前提定義書です。

------------------------------------------------------------
【AI共有用・最優先サマリ】（必ず最初に読む）
------------------------------------------------------------

・dipper は「DDNS サーバー側に不要な負荷をかけない」ことを最優先する
・正解は仕様書ではなく「今、実際に動いている挙動」
・テストは善悪を裁かず、事実を保存する（歴史のスナップショット）
・挙動変更は歓迎だが、必ず別Issueとして切り出す
・説明・作業は対話式・ステップ式で進める（先読みしない）

------------------------------------------------------------
【設計思想（要約）】
------------------------------------------------------------

最優先事項：
・DDNS サーバー側に不要な負荷をかけない
・アクセス回数を必要最小限に抑える

方針：
・「最速更新」や「常時更新」は目的にしない
・ユーザーの許容ダウンタイムと実用性のバランスを取る

実装上の考え方：
・cron / systemd timer は使わない
・短周期ループ + cache 判定による「疑似スケジューラ方式」を採用
・状態はメモリではなくファイル（cache）で保持し、挙動を可視化する
・高度な抽象化より、後から読んで思い出せる Bash を優先する

判断基準：
・最終判断は机上ではなく、実機ログと実運用結果で行う

配布思想：
・install.sh / uninstall.sh を用意する
・一般ユーザーが安心して導入・撤去できることを重視する

------------------------------------------------------------
【ファイル構成と責務分離（概要）】
------------------------------------------------------------

dipper/
├─ bin/
│  ├─ dipper.sh              # 全体制御・疑似スケジューラ
│  ├─ dns_select.sh          # DDNS 処理振り分け
│  ├─ time_check.sh          # 時間変換・丸め処理
│  ├─ err_message.sh         # エラーログ出力（logger）
│  ├─ ip_check.sh            # IP取得
│  ├─ cache/                 # キャッシュ操作ロジック
│  │  ├─ initial.sh          # cache初期化
│  │  ├─ time_check.sh       # cacheの時間ゲート
│  │  ├─ reset.sh            # cacheリセット
│  │  └─ count.sh            # cache記録（通知用）
│  ├─ dns_service/           # 各DDNSサービス処理
│  │  ├─ mydns.sh
│  │  └─ cloudflare.sh
│  └─ mail/
│     └─ sending.sh          # メール送信処理
├─ cache/                    # 実行状態データ
│  ├─ ddns_cache
│  ├─ err_mail
│  ├─ ip_cache
│  └─ update_cache
├─ config/
│  ├─ default.conf           # 設定テンプレート
│  └─ user.conf              # ユーザー設定
└─ systemd/
   └─ dipper.service

------------------------------------------------------------
【開発環境（作者の標準構成）】
------------------------------------------------------------

・Windows + VSCode
・WSL2（Ubuntu）
・GitHub（VSCode の Git 機能）
・実機テスト環境：AlmaLinux 9 / AlmaLinux 10

考え方：
・Bash は「実機で動くか」がすべて
・CI や仮想環境は補助
・最終確認は常に実機

------------------------------------------------------------
【GitHub 運用ルール（簡易）】
------------------------------------------------------------

1. Issue を作成
2. Issue から作業ブランチを作成
3. ローカルで修正
4. VSCode 上でシミュレーション的にデバッグ
5. 問題なければ作業ブランチにコミット
6. AlmaLinux10 実機で軽く運用テスト
7. main にマージ
8. リリース作成
9. AlmaLinux9 実機で本番運用テスト
10. 安定したら安定版扱い

※ 性質が同一の作業は、1 Issue / 1 ブランチでまとめる場合がある

------------------------------------------------------------
設計・コーディングの考え方
------------------------------------------------------------
・技術的に正しすぎる設計は不要。判りやすい処理にする事を優先
・不要になったものは削除する
・命名・責務分離・コメントを重視
・特に「センスのいい名前」を大事にする
・GitHub Actions（bats）を整備中
・品質保証および最終判断は、実機ログと実運用の結果を基準とする

------------------------------------------------------------
【テストに対する考え方】
------------------------------------------------------------

・現在はホワイトボックステストを主とする
・テストはコードの挙動を忠実に追うことを目的とする
・仕様書が未完成でも問題ない
・今、実際に動いている挙動を正解とする
・テストは善悪を裁かず、事実を保存する（歴史のスナップショット）
・仕様として正しいかの判断はコードレビュー時に行う
・ブラックボックステストは仕様書整備後に検討する
・最終的な品質判断は実機ログと実運用結果

------------------------------------------------------------
【次の ChatGPT への引き継ぎメモ】
------------------------------------------------------------

・一人称は「私」を使用する
・「以前の君」「前のChatGPT」は断絶ではなく連続した判断として扱う
　→ 回答時は「以前の私は〜」という表現を用いる
・距離感は「技術的な相棒」
・過剰に高度な設計案は不要（壊れにくさ・追いやすさ優先）
・「今やるべきでないこと」は今はやらない（別Issueに分ける）
・bin 配下の各スクリプトは、
・設定値が外部から注入される前提で設計されている。
・単体実行時は必要な環境変数を明示的に与えること。

役割：
・テスト担当（ホワイトボックステスト）
・レビュー時は仕様観点の指摘も行う

対話ルール：
・説明は対話式・ステップ式で進める
・1ステップでは複数コマンドをまとめて提示してよい
・結果確認前に次ステップへ先読みしない
・流れ：
  次にやること提示 → 実行結果を貼る → 考察 → 次ステップ提示

情報取得ルール：
・必要な情報は最小化する
・関数単位で足りる場合は sed 等で該当箇所のみ抽出させる
・全体が必要な場合のみ全ファイルを要求する

テスト作成ルール：
・最初に方針（戻り値の意味・判定基準）を固定する
・その後ケースを量産する
・現状の挙動と違う場合、テストは現状に合わせる
・挙動変更は必ず別Issueとする

------------------------------------------------------------
【補足】
------------------------------------------------------------

この開発ルールと設計思想は、
作者自身が「迷わず・疲弊せず・長く付き合う」ためのものである。

ChatGPT は文章生成を支援するが、
最終的な判断・取捨選択・責任はすべて人間が持つ。

dipper は、ツールである前に
作者の思考と経験の記録である。
